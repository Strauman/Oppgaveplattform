%!TEX root = ../main.tex
\newcommand{\pTitleLeading}{1em}
\newcommand{\ppLeading}{0.5em}
\newcommand{\pMargin}{2em}
\newcommand{\ppMargin}{1em}
\newcommand{\vsSize}{1em}
\newcommand{\vs}{\vspace{\vsSize}}
\makeatletter
\newcommand\refcounter[1]{
\edef\@currentlabel{#1}%
}
\makeatother
\newcounter{ProblemCounter}
\newcounter{PartProblemCounter}[ProblemCounter]
\renewcommand{\thePartProblemCounter}{\alph{PartProblemCounter}}

\newcounter{CyclicProblemIndexCounter}
%% Reference problems
\DeclareRobustCommand{\pplabel}[1]{
	\refcounter{\theProblemCounter}\label{pr:\setNo:#1}
	\refcounter{\thePartProblemCounter}\label{pp:\setNo:#1}
}
\let\pptag = \pplabel

\newcommand\ppref[1]{
	\ref{pr:\setNo:#1}\ref{pp:\setNo:#1}\relax%
}
\newcommand\pref[1]{
	\ref{pr:\setNo:#1}\relax%
}



%% Define headers used throughout, mostly for language support
\def\ProblemHeader{Problem}
\def\SolutionHeader{Solution}
\def\DiscussionHeader{Discussion}
\def\IdeaHeader{Idea}
\IfLanguageName{norsk}{
	\def\ProblemHeader{Oppgave}
	\def\SolutionHeader{Løsningsforslag}
	\def\DiscussionHeader{Diskusjonsmomenter}
	\def\IdeaHeader{Idé}
}{}

%%% Style for problems and part problems
%% bp: begin problem, ep: end problem
\newcommand{\bp}[1]
{
	\Needspace{7\baselineskip} % Won't put it on the page unless there is room
	{\LARGE{\textbf{\ProblemHeader\ #1}}}
	\vspace{\pTitleLeading}
	\normalsize
	\begin{addmargin}{\pMargin}
}
\newcommand{\ep}{
	\end{addmargin}
	\vspace{2em}
}

%% bpp: begin part problem. Argument is part problem name
%% epp: end part problem
\newcommand{\bpp}[1]{
	\Needspace{3\baselineskip} % Won't put it on the page unless there is room
	\vspace{\ppLeading}
	   \begin{addmargin}{\ppMargin}
		\hspace{-5ex}\large{\textbf{(#1)}}\normalsize
		}
\newcommand{\epp}{\hfill
\end{addmargin}
}



%% Automatic problem numbering
\newcommand{\bpa}[0]{
\stepcounter{problem}
\bp{\theproblem}
}

\newif\ifLabelBranches
\let\LabelBranches = \LabelBranchestrue

%% Automatic problem numbering with branching
%% Takes a list of {path1,...,pathN}
%% Outcome is governed by \BranchNos, set by \Branches{},
%% which indexes the argument list. If \BranchNos is empty,
%% all indexes are printed. If \BranchNos is not empty but
%% does not contain any relevant index for the input list,
%% nothing is printed.
\newcommand{\branchProblem}[1]{
	\stepcounter{problem}
	\newcounter{BranchIndexCounter}

	\ifx\branchNos\empty
		\foreach \path in #1{
			\stepcounter{BranchIndexCounter}
			\bp{\theproblem\ - Branch \Alph{BranchIndexCounter}}
			\input{\path}
			\ep
		}
	\else
		\foreach \path in #1{
			\stepcounter{BranchIndexCounter}
			\foreach \branchNo in \branchNos{
				\ifnumcomp{\branchNo}{=}{\theBranchIndexCounter}{
					\ifLabelBranches
						\bp{\theproblem\ - Branch \Alph{BranchIndexCounter}}
					\else
						\bp{\theproblem}
					\fi
					\input{\path}
					\ep
				}{
					%% EMPTY ELSE STATEMENT
				}
			}
		}
	\fi
}


%% %% %% %% %% %% %% %% %% %% %% %% %% %% %%
%%   When to show different environments  %%
%% %% %% %% %% %% %% %% %% %% %% %% %% %% %%


%% Showing and hiding environments
%% Hidden by default. Show with, preferably in main
%\displaySolutions
%\displayDirections
%\displayIdeas

\def\pSkip{\stepcounter{ProblemCounter}}
\def\ppSkip{\stepcounter{PartProblemCounter}}

\def\bex{}
\def\eex{}
% \def\bex{\ifDisplaySolutions\textbf{Oppgave}:\\\fi}
% \def\eex{}

\newif\ifDisplaySolutions
\newif\ifDisplayDirections
\newif\ifDisplayIdeas

\let\DisplaySolutions = \DisplaySolutionstrue
\let\DisplayDirections = \DisplayDirectionstrue
\let\HideDirections = \DisplayDirectionsfalse
\let\DisplayIdeas = \DisplayIdeastrue

\newcommand\IsTeacherCopy[0]{
	\DisplaySolutions
	\DisplayDirections
}

\newcommand\SolutionManual[0]{
	\DisplaySolutions
	\HideDirections
}


\NewEnviron{solution}{\ifDisplaySolutions\paragraph{\SolutionHeader:}\BODY\else\fi}
\NewEnviron{direction}{\ifDisplayDirections\paragraph{\DiscussionHeader:}\BODY\else\fi}
\NewEnviron{idea}{\ifDisplayIdeas\paragraph{\IdeaHeader:}\BODY\fi}


%%Clearpage if solution included
\def\solbreak{\ifDisplayDirections\else\ifDisplaySolutions\clearpage\fi\fi}
\def\probbreak{\ifDisplaySolutions\else\ifDisplayDirections\else\clearpage\fi\fi}
\def\tbreak{\ifDisplaySolutions \ifDisplayDirections \clearpage \fi \fi}
\def\tosbreak{\ifDisplayDirections\clearpage\fi\ifDisplaySolutions\clearpage\fi}
\let\sbreak = \solbreak
\let\pbreak = \probbreak
\newif\ifshowtoc
\newif\ifGenerateTOC
\let\GenerateTOC = \GenerateTOCtrue
\let\ShowTOC = \showtoctrue

\newif\ifResetProblemCounterOnSet
\let\ResetProblemCounterOnSet = \ResetProblemCounterOnSettrue
\let\KeepProblemCounterOnSet = \ResetProblemCounterOnSetfalse
